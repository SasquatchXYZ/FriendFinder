<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="images/quiz.png" type="image/png">
    <title>Survey | Friend Finder</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
          integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"
            integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl"
            crossorigin="anonymous"></script>

</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-header">
                    <h1 class="display-4 text-center">Survey Questions</h1>
                </div>
                <div class="card-body">
                    <form method="POST" role="form">
                        <h5 class="card-title">About You</h5>
                        <div class="form-group">
                            <label for="name">Name: (Required - Letters Only)</label>
                            <input type="text" class="form-control" id="name" placeholder="Vima Sunrider">
                        </div>
                        <div class="form-group">
                            <label for="photo">Link to a Photo: (Required)</label>
                            <input type="text" class="form-control" id="photo" placeholder="Valid Photo URL...">
                        </div>
                        <hr>

                        <div class="form-group">
                            <h5 class="card-title">Question 1</h5>
                            <label for="q1">I can work even when things are disorganized.</label>
                            <select class="custom-select" id="q1">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 2</h5>
                            <label for="q2">I prefer achieving my goals than assisting others to achieve their
                                goals.</label>
                            <select class="custom-select" id="q2">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 3</h5>
                            <label for="q3">I would describe myself as an extremely competent person.</label>
                            <select class="custom-select" id="q3">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 4</h5>
                            <label for="q4">I believe I am more intelligent than most.</label>
                            <select class="custom-select" id="q4">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 5</h5>
                            <label for="q5">I tend to take on other people's problems.</label>
                            <select class="custom-select" id="q5">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 6</h5>
                            <label for="q6">I am able to complete tasks as well as, or better than other
                                people.</label>
                            <select class="custom-select" id="q6">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 7</h5>
                            <label for="q7">If people are rude to me I just shrug it off.</label>
                            <select class="custom-select" id="q7">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 8</h5>
                            <label for="q8">It's better to get a job done than aim for perfection.</label>
                            <select class="custom-select" id="q8">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 9</h5>
                            <label for="q9">I approach life in an easy-going manner</label>
                            <select class="custom-select" id="q9">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <h5 class="card-title">Question 10</h5>
                            <label for="q10">I like to be in charge of other people.</label>
                            <select class="custom-select" id="q10">
                                <option selected>Chose an Option:</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>

                    </form>
                    <button type="submit" class="btn btn-success" id="quiz-results">
                        <i class="fas fa-vials"></i> Get Results
                    </button>
                    <a href="/home" class="btn btn-warning"><i class="fas fa-house-damage"></i> Back to Homepage</a>
                    <!--<button type="submit" class="btn btn-success" id="quiz-results">
                        <i class="fas fa-vials"></i> Get Results
                    </button>-->
                </div>
            </div>
        </div>
    </div>
</div>
<footer class="mt-3">
    <div class="container">
        <div class="row text-center">
            <div class="col-sm-4"></div>
            <div class="col-sm-4">
                <ul class="list-inline">
                    <li class="list-inline-item">
                        <a href="/api/friends"><i class="fas fa-code-branch"></i> API Friends List</a>
                    </li>
                    <li class="list-inline-item">
                        <a href="https://github.com/SasquatchXYZ/FriendFinder" target="_blank">
                            GitHub Repo <i class="fab fa-github"></i></a>
                    </li>
                </ul>
                <!--<p><a href="/api/friends"><i class="fas fa-code-branch"></i> API Friends List</a> |
                    <a href="https://github.com/SasquatchXYZ/FriendFinder" target="_blank">
                        GitHub Repo <i class="fab fa-github"></i>
                    </a>
                </p>-->
            </div>
            <div class="col-sm-4"></div>
        </div>
    </div>
</footer>

<div class="modal fade" id="quizResultsModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quizResultsModalTitle">Your Best Match:</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title" id="match-name"></h5>
                    </div>
                    <img class="card-img-bottom" id="match-photo" src="" alt="Match Image Here">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">

    // On Click Function for the Submit button for the Quiz.
    $("#quiz-results").on("click", function (event) {
        event.preventDefault();

        let validResponse = true;
        let validity = checkForm(validResponse); // Function call to check form entries.

        if (validity === true) {
            //console.log($("#q1").val().trim());
            //console.log(parseInt($("#q1").val().trim()));

            let newUserScores = [];

            for (let k = 1; k <= 10; k++) {
                newUserScores.push(parseInt($(`#q${[k]}`).val()))
            }

            let newUser = {
                name: $("#name").val().trim(),
                photo: $("#photo").val().trim(),
                scores: newUserScores
            };

            //console.log(newUser);
            //console.log(typeof newUser.scores[2]);

            $.post("/api/friends", newUser)
                .then(function (data) {
                    console.log(JSON.stringify(data, null, 2));
                    $("#match-name").text(data.name);
                    $("#match-photo").attr('src', data.photo);

                    $("#quizResultsModal").modal('show');
                });

            $(".form-control").val('');
            $(".custom-select").val('Chose an Option:');

        } else {
            alert(`Warning: ${validity}`)
        }
    });

    function checkName() {
        let validResponse = true;

        let checkName = $('#name').val().trim();
        console.log(checkName);
        const parse_name = /^[a-z]+(?:\s?)?(?:[a-z]+)?$/i;

        if (!parse_name.test(checkName)) {
            console.log('Name Not Valid');
            validResponse = false;
            console.log(validResponse);
            return validResponse
        }

        console.log(validResponse);
        checkPhoto();
        /*let checkPhoto = $('#photo').val().trim();
        console.log(checkPhoto);
        const parse_url = /^((https?|ftp):\/\/.*(jpg|jpeg|png|gif|bmp))$/*/

    }

    function checkPhoto() {
        let validResponse = true;

        let checkPhoto = $('#photo').val().trim();
        console.log(checkPhoto);
        const parse_url = /^((https?|ftp):\/\/.*\.(?:png|jpg|gif|jpeg|bmp))/i;

        if (!parse_url.test(checkPhoto)) {
            console.log('Photo Not Valid');
            validResponse = false;
            console.log(validResponse);
            return validResponse;
        }

        console.log(validResponse);
        checkForm();
    }


    function checkForm(validResponse) {
        // Checks the Value entered as the Persons 'Name' and ensures that it is simply letters, and in the
        // format 'Name' || 'FirstName LastName' || 'FirstName LastInitial'.--------------------------------------------

        let checkName = $('#name').val().trim();
        console.log(checkName);
        const parse_name = /^[a-z]+(?:\s?)?(?:[a-z]+)?$/i;

        if (!parse_name.test(checkName)) {
            console.log('Name Not Valid');
            validResponse = `That is not a valid entry for 'Name'.`;
            console.log(validResponse);
            return validResponse // Returns Error Message.
        }

        // Checks the Photo URL to ensure that it is in the format of an image URL -------------------------------------
        let checkPhoto = $('#photo').val().trim();
        console.log(checkPhoto);
        const parse_url = /^((https?|ftp):\/\/.*\.(?:png|jpg|gif|jpeg|bmp))/i;

        if (!parse_url.test(checkPhoto)) {
            console.log('Photo Not Valid');
            validResponse = `That is not an acceptable photo url.`;
            console.log(validResponse);
            return validResponse; // Returns Error Message.
        }

        /*$(".form-control").each(function () {

            if ($(this).val().trim() === "") {
                validResponse = false;
                console.log(validResponse)
            }
        });*/

        // Checks to ensure that each of the questions in the survey has been properly answered ------------------------
        $(".custom-select").each(function () {

            //console.log($(this).val());
            if (isNaN(parseInt($(this).val()))) {
                validResponse = `You must answer all of the questions in the survey.`;
                console.log('Missing a question');
                console.log(validResponse);
                return validResponse; // Returns Error Message.
            }

        });

        console.log(validResponse);
        return validResponse // Returns 'true' if all the form fields check out.
    }

</script>
</body>
</html>